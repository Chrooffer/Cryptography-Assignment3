import java.io.BufferedReader;
import java.io.FileReader;
import java.math.BigInteger;

public class FiatShamir {

	public static class ProtocolRun {
		public final BigInteger R;
		public final int c;
		public final BigInteger s;

		public ProtocolRun(BigInteger R, int c, BigInteger s) {
			this.R = R;
			this.c = c;
			this.s = s;
		}
	}

	public static void main(String[] args) {
		String filename = "input.txt";
		BigInteger N = BigInteger.ZERO;
		BigInteger X = BigInteger.ZERO;
		ProtocolRun[] runs = new ProtocolRun[10];
		try {
			BufferedReader br = new BufferedReader(new FileReader(filename));
			N = new BigInteger(br.readLine().split("=")[1]);
			X = new BigInteger(br.readLine().split("=")[1]);
			for (int i = 0; i < 10; i++) {
				String line = br.readLine();
				String[] elem = line.split(",");
				runs[i] = new ProtocolRun(
						new BigInteger(elem[0].split("=")[1]),
						Integer.parseInt(elem[1].split("=")[1]),
						new BigInteger(elem[2].split("=")[1]));
			}
			br.close();
		} catch (Exception err) {
			System.err.println("Error handling file.");
			err.printStackTrace();
			System.exit(1);
		}
		BigInteger m = recoverSecret(N, X, runs);
		System.out.println("Recovered message: " + m);
		System.out.println("Decoded text: " + decodeMessage(m));
	}

	public static String decodeMessage(BigInteger m) {
		return new String(m.toByteArray());
	}

	/**
	 * Recovers the secret used in this collection of Fiat-Shamir protocol runs.
	 *
	 * @param N
	 *            The modulus
	 * @param X
	 *            The public component
	 * @param runs
	 *            Ten runs of the protocol.
	 * @return
	 */
	private static BigInteger recoverSecret(BigInteger N, BigInteger X,
			ProtocolRun[] runs) {
		// TODO. Recover the secret value x such that x^2 = X (mod N).
		return BigInteger.ZERO;
	}
}
/*
Special Soundness of Fiat-Shamir sigma-protocol (5 points)

We eavesdropped on a number of Fiat-Shamir protocol runs
and we found that the same nonce was used twice!
Due to the special soundness property you should
now be able to retrieve the secret key used in the protocol.

The Fiat-Shamir protocol is a zero-knowledge protocol, briefly explained here.
The text box below displays (n), the modulus used,
and (X) the public key of the prover.
We know that X = x2 and your task is to find x.
The rest of the input is a sequence of runs of the Fiat Shamir protocol.
R is the random value sent to the verifier, c is the
challenge sent to the prover, and s is the
proof sent back to the verifier.
Give me a hint

Skeleton code: Place the above data in a file called input.txt and use one of the following files to get you started: FiatShamir.java, fiat_shamir.cpp or FiatShamir.hs.

n=29755410306056143529148785075978747549288643666838854146637959848208537124332231161768701386415018507384180494427681130946709645307004234512331534681063012604399734905609259597287391035205965607381490257390567128343383133805488091305278397422653889191962712631217508726597589338743996500119975200600766490757314676375117764228483310737650599068490184597670024838231745304043047978414942094017456040856041228203889775378499047223359189152354615168371862790040583219486592434814135835316634325807208614989933586241389227199727087925965448004363710371210780097258696587558897531737955867347716473892520930238502344487629
X=15376970122013763480412853961236305788895713748963249600513173324592838185894941803288162714299942305285996801232735118277505972436259955220112743170715107760970846266858212826294824685083838587281037939182613001327884819025421798282114520402398660882521121110215656403153916346507402541710468037709372351266854471102705630383188689005454575690049195603996617406854726115436519882456379494308740727298376320313733402087076294526149479942593739443699825890216412087206699485417368890091880255884721078232486915575663957801814571732743361416627419524786382148171616803371647773127577719223245903407577293480252571408390
R=1687458320946183133274261319765565224224618132184458872616974739748825545936841545376239521669804050597393020991230153647255698502096243293644307698305809458191797629331149236879894393043350413321752884901338133154129263741086127696350191342461473343535326298125815090359313453738828583189110645340806287251026218184400622186309820262991296448980230070988860194008060367227006326946727391997678966190814266671830938129940977202828279841885152942467449161529598013628461750218183691991566745245843147738160572554064178395408856542425771521287455476948627703613585571052422677336815714115704212384385875182785152651587,c=0,s=177321371038581603513923051796274328364773844996113185668844583147558780584809942163406679509388758872224000436171209111053268438468025163783146155078069651973239136110595457429094859342626912864046240684643044114132599027573649966429003150222993337652951312599698702756554958636753595974986549891628234422404
R=2342132455123670980804687681917720728875694244934101466825387633393317597807662921653257916258686967423939142180857056446582716066833190593647398834757731995232568740451497378548985678577291083149776000006813310289481993629881409885534499263471106639379977498278536688539494950685433394177560004972201444583966970494391558070408112874527759824720689318516401931591184644456444972409812163170764682835128809582528209590682532505213314306142303632341869908680721634515681794260978012387668620569738746034827068069594047223977435651619660418442506414640626156233296781148613186916033117704012272393169211385401575594441,c=1,s=20810427649401602376710947599447795051227026666766998723060393694328543258030418993975821304047657570769063079642349814676525033484091467973127356771751970742677331931536444401623282680814669214049083968197423057066221400555635003992398646162812440165859455997371023194741520858140306385447541635455794992833453250652361680630958964891906833940236514909909150217358899272824902114217588544956078318127746448567971406071025699165632792757034612455955731235986402582419804498647571462480953120919938457620856277326874340691766887195217837649449800136823941797356544915369737573603993229385682496569128830404366801734101
R=11624364114040730698278263265781769722726559232017533455864653398071624372720415454971672933487536598783727425342307168575941147066880077254357411665342576260582282768357997605150457990639865314304947210452442311008772283116791655309741947756267992284264056139495419131005901084461258472558680057724191498894579891634627307797104875721890403923262017326251971070757414649718282240173057527137693699733657521115435661633104949376215192641905660609232080719742948647942312576381833140570154376255129183526966637319243139980332273111964638285398036946074401761395996069255351976412250647483280315905879207155018800777729,c=1,s=26162428169040344558556803902354870471414662536020030652763673116310933572853975388301597537355874722973249543629191758625278532493029968172297097036563440252122923636480525532485806219300311779893832067264195633699735756171404551949378134850909503907280659459130902575333674115942271599534849873599061767069619490889713519143373160477659511366485740143292778408338288605757182159205622082706439165940110094878958217323554289315108122402476373945063449888400845625653516777548947359035349952757634437882824194286182259688897536365803001257026510287677601485943819425533261562710708966175193071054231026566876893645561
R=23914953090562068079195334835757141150392312041904903579598053149491508531269766001184190594786354423911133995273028921813847480214383887394695796470877122951952978553050525116569931270668208753998454742427356219503384625965215461070661032091935931787677192565491146999074092952009092124547899310202109866151193110241340118012895358102398447480147560049737406572629072516314108711533434900611212028373547188355117878802270644221834750488344970430396556451276621273540980624528692414584888935046341641426293967974458018813840237660367761589436309661890925442036112095916129153331693943291445769949518799310821477877225,c=0,s=154644602526444705137691476836178925674238126788914599210378790973527432470143661812048242769840732841128518155331435603148338547545045404137162982779191054109346530966427715069807327423511058262058000082466585312984692785958331567497077724932520617726396983840698620897266422637898622128590305886962771354835
R=26968518141948707523709988847945852116273261030849527313151669832343986247761115618479374603488999608769698616435168156762617627319674199224177289696989971516937590788626651318005206772708404117684915137742248382025659885920276698097789330580933587342568480794555603423117114691309069241132155805579857073581918376590959185598428064215937221766694131222144426746140144354512437903589552503340029879345191749500592309204780247347666484977457858147334664164597602962007007102889008363855182748421682785985053246165605822058091038164160153704004108561302321542525908307997344660335769874111883987313970123413466085200601,c=0,s=164220943067407536805966985677636920715212580323794799166552832295591827836678309651360823706630069212781205879950765931629309978589185867161989663698604284222563722391497938940352152796555441752812550943704446118487007290964372995221938959844072513943210484717049818054747857492233620045530312459291540350949
R=23496879455854390887640605914018402448551047938827076573544551874192245716760429966122451576541024193490313469590771091275121085838620691705807038861362444133237776764182054791942537089269492482777034798059298746701816704003347919510293345026676055396080592635029296378623276346009095603539831143427097060395259456796815994391892539392372188604664683179192716288212711124601535919866254672858138498940556330842716838262751624336347289048817043792315582459962719005202251965451577919678515481583914839310822127811864961119670132045632049745913711191592274583796475271117943866303561317016743145498503362038785063456481,c=0,s=153286918736904588115641525026079256564832355752503278730810404546524585403359784280998866122201492554747769220310381051125560098682218855074660179159922958224408786975967473573462943451271075853449314307150698358224334019314672897668857243412509727454363828148774796188288688549816830314809000845917488908559
R=11624364114040730698278263265781769722726559232017533455864653398071624372720415454971672933487536598783727425342307168575941147066880077254357411665342576260582282768357997605150457990639865314304947210452442311008772283116791655309741947756267992284264056139495419131005901084461258472558680057724191498894579891634627307797104875721890403923262017326251971070757414649718282240173057527137693699733657521115435661633104949376215192641905660609232080719742948647942312576381833140570154376255129183526966637319243139980332273111964638285398036946074401761395996069255351976412250647483280315905879207155018800777729,c=0,s=107816344373386777791596130528183112798384839767857853159135547948137485723672101497524802619532664427037633008613001511384808420930634345363662861409101508839025712798956411795561830182691338511307158090959327227188278958829221487661262097772793284026346591965248774882020730294658531657514491214698008468223
R=7634273700798902529547956808967045005866527776830528637033268740285254106698629478889230951345096790671197090278148403353261610395991041828839136643742285026451324615641078937376297005621696562890793289670179122044585591327421322022295361185179711550662648120094093107642085775960557715084965444238186344844440719734458587969640321695062069421185363287681427443627520880416454472566264067879601306486153624183177085218409266665634897049877029589277362594509217720205736112471669082787064508247416288807912821454571049448643307160404424585147623063216611932416232236749277475018132104907811619624821115314798778878225,c=1,s=28558726686640882140155612127214570726667319064381851140638958364415681367540630756289806086572421907677012525616200454088013019047002239634741033976852165347830822266162247703393881338047163957218903049060883095280585243269688946704912964861706296091805868471414137283372051572849045519268669031298514388740235774882165088245990643116672346110933644168049225925457829873390429252597050956754593876085672242512929284102823210858163356450758450083926178992020370455940568889455089086180135893068536679371745049123628911525142154191644379830515609912229496937035147336734458522346411680317210504494436907932940986688783
R=24449709589710187751064996229413738294994725925151734502995783384079739388100833814590418496873813776640223513557897539995425326904936607655379496939419004397450605066972150556110961153556292550881941366796553358386364126076477629748980415913356107206483021512038978556554001664501778089652842317344452333908513640131012537478844672143819726218894411112245074594499800627536650190834859570129797958537341070091447887544655372363864061853992783034986627529562311909568987978981511172090341286928983865689122846641511567151259251549516085648047637938206053174191205594346086197790096901399072543382022258360435865062500,c=0,s=156364029078654108947520555942841895940475111991600617801628763085405121761973241459287181002479159113335285525988278927857458370878684056963105771582001112588862801893534214099633432168816611246903148142412082088721699823035948884965174620655768865537729438461195626590840823367832886380995425784639764117750
R=16395084587377425311359502700184943371832132596018141649009032757887408033486607160651349748541520895521204665939265057729294717078518327038759638564141169248310061659376062766081155079205651723144619336404865423778159295459119881843448853440239696247445415759965958158673397902730412254811555927058277017102268888299640113499890071310891998921861399486807677163610932575410345533208700577438470257075687175310323622774546027825026621769424515348689016926677616638508781221703743487642620930776536457779156156304216347936765383516696396973390081691571771402177799831730131098702713063154782951836697298920442073733124,c=1,s=16807554514774375769419074810529147951103662414190848467423152475268764322981715877225395256517620055124864748383909531863733004407705984982241953526774728985857475706697145379528507174796988323214610536741319944666458989451835331600373149937391897969616041607716328943545351227757149920054028458011614384618293062915055045432785733363217799296217808522463606304768612301400846396988793226361412147923713832870518690583579293308150391581558965294441779035637563684859098385520120428322707307492313717156919098142357157191996175351015111658131129132873637189340728361175204962704664758565064085848799925401283160594563
*/
